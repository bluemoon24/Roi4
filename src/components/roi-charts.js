import{scaleBand,select,scaleLinear,axisBottom,axisLeft}from"d3";function countBarSeriesHorizontalDimensions(e,a,t,n){if(t===a.maxSize)return{margin:0,bandwidth:n};var r=t*n/a.maxSize;return{margin:Math.abs(n/2-r/2),bandwidth:r}}function countBarSeriesVerticalDimensions(e,a,t,n){if(t===a.maxSize)return{margin:0,bandwidth:n};var r=1-t/100,i=scaleBand().domain(e.x).range(a.ranges.x).padding(r).bandwidth();return{margin:Math.abs(n/2-i/2),bandwidth:i}}var generateBars=function(e,a){return e.append("g").classed("bar-container",!0).selectAll("rect.bar").data(a).enter().append("rect").classed("bar",!0)};function calculateLabelWidth(e,a){var t=select(e.container).insert("svg"),n=t.append("text").style("font-size",e.dataLabelsSize).text(a),r=n.node().getComputedTextLength();return n.remove(),t.remove(),r}function calculateNicedLinearDomain(e){return scaleLinear().domain(e).nice().domain()}var defaults={margin:{top:5,right:25,bottom:50,left:10},orientation:"vertical",dataColors:["#231F20","#BB4430","#7EBDC2","#93827F","#F3DFA2"],sizes:{bar:50,bullet:18,inset:40,dot:10},seriesType:"bar",xTickExtension:12,horizontalLabelMargin:36,verticalLabelMargin:36,minChartLeftMargin:34,horizontalTicksTextTop:9,axesLabelsSize:14,forecastOpacity:30,dataLabelsMargin:6,dataLabelsSize:12,dataOuterPadding:.3},countHorizontalChartLeftMargin=function(e,a,t){return Math.max.apply(Math,t.map(function(a){return calculateLabelWidth(e,a)}))+defaults.minChartLeftMargin},countVerticalChartLeftMargin=function(e,a){return calculateLabelWidth(e,Math.max.apply(Math,a.map(function(e){return e.value})))+defaults.minChartLeftMargin},extendHorizontalChartOverflowingXTicks$$1=function(e,a,t){var n=e.ticks().length-1,r=select("g.x.axis path.domain").node().getBBox().width,i=n>0?r/n:0,l=a.tickSize(),s=defaults.xTickExtension;return{overflowingXTicksExtended:extendOverflowingXTicks(t,i,l,s,"horizontal"),xTickExtension:s}},extendOverflowingXTicks=function(e,a,t,n,r){if(e.selectAll("g.tick").filter(function(){return select(this).node().getBBox().width>a}).size())return"horizontal"===r&&e.selectAll("g.tick line:not(.drawn-domain)").attr("y2",function(e,a){return a%2==0?t:t+n}),e.selectAll("g.tick text").attr("y",function(e,a){return a%2==0?defaults.horizontalTicksTextTop:defaults.horizontalTicksTextTop+n}),!0},extendVerticalChartOverflowingXTicks$$1=function(e,a,t){var n=e.step(),r=a.tickSize(),i=defaults.xTickExtension;return{overflowingXTicksExtended:extendOverflowingXTicks(t,n,r,i),xTickExtension:i}},tickPadding=9,generateAxes$$1=function(e,a,t,n,r){var i=axisBottom(n),l=axisLeft(r);return("vertical"===a?i:l).tickSize(0).tickPadding(tickPadding),{xAxis:i,xAxisEl:generateXAxisElement(e,i,t),yAxis:l,yAxisEl:generateYAxisElement(e,l)}};function generateHorizontalAxes$$1(e,a){var t=e.config,n=e.dimensions,r=e.svg,i=a.domains,l=a.xScale,s=a.yScale,o=generateAxes$$1(r,t.orientation,n.chartHeight,l,s),c=o.xAxis,d=o.xAxisEl,u=o.yAxisEl;replaceHorizontalAxisDomainIfNullOnChart(i.y,d,u,n.chartHeight);var g=extendHorizontalChartOverflowingXTicks$$1(l,c,d),f=g.overflowingXTicksExtended,x=g.xTickExtension;generateHorizontalChartAxesLabels$$1(t,n,d,u,f,x)}var generateHorizontalChartAxesLabels$$1=function(e,a,t,n,r,i){e.valuesLabel&&generateXAxisLabel(t,a.chartWidth).attr("dy",defaults.horizontalLabelMargin+(r?i:0)).text(e.valuesLabel),e.categoriesLabel&&generateYAxisLabel(n,a.chartHeight,a.leftMarginForLabels).attr("dy",14-a.leftMarginForLabels).text(e.categoriesLabel)};function calculateXMaxDomain(e,a,t,n){var r=(a[1]-e)*t;return n>r?a[1]+(n-r)/t:a[1]}function calculateXMinDomain(e,a,t,n){var r=(e-a[0])*t;return n>r?a[0]-(n-r)/t:a[0]}function generateHorizontalDomainsAndScales$$1(e,a){var t=a.dimensions,n=a.labels,r=[Math.min(0,t.minValue),t.maxValue],i=calculateNicedLinearDomain(r),l=e.dataLabelsMargin+calculateLabelWidth(e,t.maxValue),s=e.dataLabelsMargin+calculateLabelWidth(e,t.minValue),o=t.chartWidth/(i[1]-i[0]),c={x:[t.minValueHasLabel?calculateXMinDomain(t.minValue,i,o,s):r[0],t.maxValueHasLabel?calculateXMaxDomain(t.maxValue,i,o,l):r[1]],y:n.reverse()},d=scaleLinear().domain(c.x).range(t.ranges.x);t.minValueHasLabel&&t.maxValueHasLabel||d.nice();var u=1-t.maxSize/100,g=scaleBand().domain(c.y).range(t.ranges.y).paddingOuter(e.dataOuterPadding).paddingInner(u);return{domains:c,xScale:d,yScale:g,xScaleStart:d(0),bandwidth:g.bandwidth()}}function generateLabelsOverDataHorizontal(e,a,t){t.each(function(t){var n=e.append("text").style("fill","black").style("font-size",a.dataLabelsSize).attr("dominant-baseline","central").text(t[a.valuesKey]),r=select(this).node().getBBox(),i=r.y+r.height/2;if(t[a.valuesKey]<0){var l=r.x-a.dataLabelsMargin;n.attr("text-anchor","end").attr("transform","translate("+l+", "+i+")")}else{var s=r.x+r.width+a.dataLabelsMargin;n.attr("transform","translate("+s+", "+i+")")}})}var baselineMargin=9;function generateLabelsOverDataVertical(e,a,t){t.each(function(t){var n=e.append("text").style("fill","black").style("font-size",a.dataLabelsSize).text(t[a.valuesKey]),r=n.node().getBBox(),i=select(this).node().getBBox(),l=i.x+i.width/2-r.width/2;if(t[a.valuesKey]<0){var s=i.height+i.y+a.dataLabelsMargin+baselineMargin;n.attr("transform","translate("+l+", "+s+")")}else{var o=i.y-a.dataLabelsMargin;n.attr("transform","translate("+l+", "+o+")")}})}function generateVerticalAxes$$1(e,a){var t=e.config,n=e.dimensions,r=e.svg,i=a.domains,l=a.xScale,s=a.yScale,o=generateAxes$$1(r,t.orientation,n.chartHeight,l,s),c=o.xAxis,d=o.xAxisEl,u=o.yAxisEl;replaceVerticalAxisDomainIfNullOnChart(i.y,d,u,n.chartWidth);var g=extendVerticalChartOverflowingXTicks$$1(l,c,d),f=g.overflowingXTicksExtended,x=g.xTickExtension;generateVerticalChartAxesLabels$$1(t,n,d,u,f,x)}var generateVerticalChartAxesLabels$$1=function(e,a,t,n,r,i){e.categoriesLabel&&generateXAxisLabel(t,a.chartWidth).attr("dy",defaults.verticalLabelMargin+(r?i:0)).text(e.categoriesLabel),e.valuesLabel&&generateYAxisLabel(n,a.chartHeight,a.leftMarginForLabels).attr("dy",14-a.leftMarginForLabels).text(e.valuesLabel)};function calculateYMaxDomain(e,a,t,n){var r=(a[1]-e)*t;return n>r?a[1]+(n-r)/t:a[1]}function calculateYMinDomain(e,a,t,n){var r=(e-a[0])*t;return n>r?a[0]-(n-r)/t:a[0]}function generateVerticalDomainsAndScales$$1(e,a){var t=a.dimensions,n=a.labels,r=[Math.min(0,t.minValue),t.maxValue],i=calculateNicedLinearDomain(r),l=t.chartHeight/(i[1]-i[0]),s=e.dataLabelsMargin+e.dataLabelsSize,o={x:n,y:[t.minValueHasLabel?calculateYMinDomain(t.minValue,i,l,s):r[0],t.maxValueHasLabel?calculateYMaxDomain(t.maxValue,i,l,s):r[1]]},c=1-t.maxSize/100,d=scaleBand().domain(o.x).range(t.ranges.x).paddingOuter(e.dataOuterPadding).paddingInner(c),u=scaleLinear().domain(o.y).range(t.ranges.y);return t.minValueHasLabel&&t.maxValueHasLabel||u.nice(),{domains:o,xScale:d,yScale:u,yScaleStart:u(0),bandwidth:d.bandwidth()}}var generateXAxisElement=function(e,a,t){return e.append("g").classed("x axis",!0).call(a).attr("transform","translate(0, "+t+")")},generateXAxisLabel=function(e,a){return e.append("text").attr("transform","translate("+a/2+")").style("fill","black").style("font-size",defaults.axesLabelsSize)},generateYAxisElement=function(e,a){return e.append("g").classed("y axis",!0).call(a)},generateYAxisLabel=function(e,a){return e.append("text").attr("transform","rotate(-90) translate(-"+a/2+")").style("text-anchor","middle").style("fill","black").style("font-size",defaults.axesLabelsSize)},_extends=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},prepareChartDataAndContainer$$1=function(e){e.categoriesKey=e.categoriesKey||Object.keys(e.series[0].data[0])[0],e.valuesKey=e.valuesKey||Object.keys(e.series[0].data[0])[1],e.width=e.width||e.container.clientWidth,e.height=e.height||e.container.clientHeight,e.orientation=e.orientation||defaults.orientation,e.forecastOpacity=e.forecastOpacity||defaults.forecastOpacity,e.dataLabelsMargin=e.dataLabelsMargin||defaults.dataLabelsMargin,e.dataLabelsSize=e.dataLabelsSize||defaults.dataLabelsSize,e.dataOuterPadding=e.dataOuterPadding?e.dataOuterPadding/100:defaults.dataOuterPadding;var a=0,t=e.series.map(function(e){return _extends({},e,{type:e.type||defaults.seriesType})}).map(function(e){return _extends({},e,{dataColor:e.dataColor||defaults.dataColors[a++],size:e.size||defaults.sizes[e.type]})}),n=t.reduce(function(a,t){var n=t.data.map(function(a){return{value:a[e.valuesKey],hasLabel:!!t.dataLabels}});return[].concat(a,n)},[]),r=_extends({},defaults.margin,e.margin),i=t[0].data.map(function(a){return a[e.categoriesKey]}),l=countChartLeftMargin[e.orientation](e,n,i);r.left=r.left+l;var s=e.width-r.right-r.left,o=e.height-r.top-r.bottom,c=Math.max.apply(Math,t.map(function(e){return e.size})),d={x:[0,s],y:[o,0]},u=n.reduce(function(e,a){return e.value<a.value?e:a}),g=n.reduce(function(e,a){return e.value>a.value?e:a}),f={chartWidth:s,chartHeight:o,leftMarginForLabels:l,maxSize:c,ranges:d,minValue:u.value,maxValue:g.value,minValueHasLabel:u.hasLabel,maxValueHasLabel:g.hasLabel},x=select(e.container);return x.selectAll("*").remove(),{svg:x.append("svg").attr("width",e.width).attr("height",e.height).append("g").attr("transform","translate("+r.left+", "+r.top+")"),config:_extends({},e,{series:t}),dimensions:f,labels:i}};function replaceHorizontalAxisDomainIfNullOnChart(e,a,t,n){0<e[0]||0>e[1]||(t.select(".domain").remove(),a.selectAll("g.tick").filter(function(){return"0"===select(this).select("text").text()}).append("line").classed("drawn-domain",!0).style("stroke","black").attr("y2",-n))}function replaceVerticalAxisDomainIfNullOnChart(e,a,t,n){0<e[0]||0>e[1]||(a.select(".domain").remove(),t.selectAll("g.tick").filter(function(){return"0"===select(this).select("text").text()}).append("line").classed("drawn-domain",!0).style("stroke","black").attr("x2",n))}var setForecast=function(e,a,t){var n=a.indexOf(e.forecastStart),r=function(t){return a.indexOf(t[e.categoriesKey])>=n};t.map(function(a){return a.filter(r).style("opacity",e.forecastOpacity/100)})},countChartLeftMargin={horizontal:countHorizontalChartLeftMargin,vertical:countVerticalChartLeftMargin};function barSeriesHorizontal(e,a,t){var n=e.svg,r=e.config,i=e.dimensions,l=a.domains,s=a.xScale,o=a.yScale,c=a.xScaleStart,d=a.bandwidth,u=t.data,g=t.dataLabels,f=t.dataColor,x=countBarSeriesHorizontalDimensions(l,i,t.size,d),h=generateBars(n,u).attr("x",function(e){return e[r.valuesKey]<0?s(e[r.valuesKey]):s(0)+1}).attr("y",function(e){return o(e[r.categoriesKey])+x.margin}).attr("width",function(e){return Math.abs(s(e[r.valuesKey])-c)}).attr("height",x.bandwidth).attr("fill",f);return g&&generateLabelsOverDataHorizontal(n,r,h),h}function barSeriesVertical(e,a,t){var n=e.svg,r=e.config,i=e.dimensions,l=a.domains,s=a.xScale,o=a.yScale,c=a.yScaleStart,d=a.bandwidth,u=t.data,g=t.dataLabels,f=t.dataColor,x=countBarSeriesVerticalDimensions(l,i,t.size,d),h=generateBars(n,u).attr("x",function(e){return s(e[r.categoriesKey])+x.margin}).attr("y",function(e){return e[r.valuesKey]<0?o(0)+1:o(e[r.valuesKey])}).attr("width",x.bandwidth).attr("height",function(e){return Math.abs(o(e[r.valuesKey])-c)}).attr("fill",f);return g&&generateLabelsOverDataVertical(n,r,h),h}var generateDots=function(e,a){return e.append("g").classed("dot-container",!0).selectAll("circle.dot").data(a).enter().append("circle").classed("dot",!0)};function dotSeriesHorizontal(e,a,t){var n=e.svg,r=e.config,i=e.dimensions,l=a.xScale,s=a.yScale,o=a.bandwidth,c=t.data,d=t.dataLabels,u=t.dataColor,g=t.size*o/i.maxSize/2,f=generateDots(n,c).attr("cx",function(e){return l(e[r.valuesKey])}).attr("cy",function(e){return s(e[r.categoriesKey])+o/2}).attr("r",g).attr("fill",u);return d&&generateLabelsOverDataHorizontal(n,r,f),f}function dotSeriesVertical(e,a,t){var n=e.svg,r=e.config,i=e.dimensions,l=a.xScale,s=a.yScale,o=a.bandwidth,c=t.data,d=t.dataLabels,u=t.dataColor,g=t.size*o/i.maxSize/2,f=generateDots(n,c).attr("cx",function(e){return l(e[r.categoriesKey])+o/2}).attr("cy",function(e){return s(e[r.valuesKey])}).attr("r",g).attr("fill",u);return d&&generateLabelsOverDataVertical(n,r,f),f}var makeDomainsAndScales={horizontal:generateHorizontalDomainsAndScales$$1,vertical:generateVerticalDomainsAndScales$$1},makeAxes={horizontal:generateHorizontalAxes$$1,vertical:generateVerticalAxes$$1},barBasedSeriesCreators={horizontal:barSeriesHorizontal,vertical:barSeriesVertical},makeSeries={bar:barBasedSeriesCreators,bullet:barBasedSeriesCreators,inset:barBasedSeriesCreators,dot:{horizontal:dotSeriesHorizontal,vertical:dotSeriesVertical}};function chart(e){var a=prepareChartDataAndContainer$$1(e),t=a.config,n=a.labels,r=makeDomainsAndScales[t.orientation](t,a);makeAxes[t.orientation](a,r);var i=t.series.map(function(e){return makeSeries[e.type][t.orientation](a,r,e)});t.forecastStart&&setForecast(t,"vertical"===t.orientation?n:n.reverse(),Object.values(i))}var index={chart:chart};export default index;
